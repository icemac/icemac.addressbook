=============================================
 Editing sort order of address book entities
=============================================

The sort order of the entities can be changed globally. The places where
entities are displayed in order are changed accordingly.

Set up
======

Create an address book and a browser to access it. Log in as
`Administrator`:

>>> from icemac.addressbook.testing import create_addressbook
>>> from zope.app.wsgi.testlayer import Browser
>>> ab = create_addressbook()
>>> browser = Browser()
>>> browser.addHeader('Authorization', 'Basic mgr:mgrpw')
>>> browser.open('http://localhost/++skin++AddressBook/ab')

The sort order of the entities can be changed in the master data area:

>>> browser.getLink('Master data').click()
>>> browser.getLink('Entities').click()
>>> edit_entities_url = browser.url
>>> edit_entities_url
'http://localhost/++skin++AddressBook/ab/++attribute++entities'

Changing sort order
===================

To change the sort order of the entities the user has to select the ``up``
resp. ``down`` links.

>>> import zope.site.hooks
>>> import zope.component
>>> import icemac.addressbook.interfaces
>>> old_site = zope.site.hooks.getSite()
>>> zope.site.hooks.setSite(ab)
>>> def get_entity_titles():
...     entities = zope.component.getUtility(
...        icemac.addressbook.interfaces.IEntities)
...     return [x.title for x in entities.getEntitiesInOrder()]

The initial sort order is:

>>> get_entity_titles()
[u'address book', u'person', u'postal address', u'phone number', u'e-mail address', u'home page address', u'file', u'keyword']

Seleting the `up` link moves an entity one position up in the list. Let's move the postal address one up:

>>> browser.getLink('up', index=1).click()
>>> get_entity_titles()
[u'address book', u'postal address', u'person', u'phone number', u'e-mail address', u'home page address', u'file', u'keyword']

There is no `up` link for the first entity in the table:

.. impl.


.. Sort order visible at:
.. - master data --> entities
.. - add menu
.. - person add form
.. - person edit form
.. - export
.. - importer (?)


Tear down
=========

>>> zope.site.hooks.setSite(old_site)


