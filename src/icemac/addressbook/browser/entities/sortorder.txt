=============================================
 Editing sort order of address book entities
=============================================

The sort order of the entities can be changed globally. The places where
entities are displayed in order are changed accordingly.

Set up
======

Create an address book and a browser to access it. Log in as
`Administrator`:

>>> from icemac.addressbook.testing import create_addressbook
>>> from zope.app.wsgi.testlayer import Browser
>>> ab = create_addressbook()
>>> browser = Browser()
>>> browser.addHeader('Authorization', 'Basic mgr:mgrpw')
>>> browser.open('http://localhost/++skin++AddressBook/ab')

The sort order of the entities can be changed in the master data area:

>>> browser.getLink('Master data').click()
>>> browser.getLink('Entities').click()
>>> edit_entities_url = browser.url
>>> edit_entities_url
'http://localhost/++skin++AddressBook/ab/++attribute++entities'

Changing sort order
===================

To change the sort order of the entities the user has to select the ``up``
resp. ``down`` links.

The initial sort order is:

>>> import zope.site.hooks
>>> import zope.component
>>> import icemac.addressbook.interfaces
>>> old_site = zope.site.hooks.getSite()
>>> zope.site.hooks.setSite(ab)
>>> order = zope.component.getUtility(icemac.addressbook.interfaces.IOrderStorage)

>>> fix tests here

.. There should be an easier way defined on IEntities:
.. What is faster: iter over order storage + get utility for each item
..             or: get all utilites and sort using index in
..                 order_storage.__iter__?

>>> [icemac.addressbook.interfaces.IEntity(x).title for x in order.__iter__(icemac.addressbook.interfaces.ENTITIES)]
[u'address book', u'postal address', u'phone number', u'e-mail address', u'home page address', u'file', u'person', u'keyword']

.. Default sort order is wrong, person comes to late!

.. Sort order visible at:
.. - master data --> entities
.. - add menu
.. - person add form
.. - person edit form
.. - export
.. - importer (?)


Tear down
=========

>>> zope.site.hooks.setSite(old_site)


